<%- include("header") %>
<!-- <link rel="stylesheet" href="/styles/welcome.css"> -->
<!-- <link rel="stylesheet" href="/css/fontawesome.css"> -->

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center mb-4">Office Details</h1>
            <h1 class="text-center">My Reservations</h1>
            <div class="filterSection">
                <form action="/filter" method="post" id="filterForm">
                    
                    <!-- Year Filter -->
                    <div class="yearFilter">
                        <h2>Year Filter</h2>
                        <label for="year2019">
                            <input type="checkbox" id="year2019" name="year" value="2019" 
                            <%= selectedYears.includes('2019') ? 'checked' : '' %> 
                            onchange="this.form.submit()">
                            2019
                        </label><br>
                        <label for="year2020">
                            <input type="checkbox" id="year2020" name="year" value="2020"
                            <%= selectedYears.includes('2020') ? 'checked' : '' %> 
                            onchange="this.form.submit()">
                            2020
                        </label><br>
    
                        <label for="year2021">
                            <input type="checkbox" id="year2021" name="year" value="2021"
                            <%= selectedYears.includes('2021') ? 'checked' : '' %> 
                            onchange="this.form.submit()">
                            2021
                        </label><br>
    
                        <label for="year2022">
                            <input type="checkbox" id="year2022" name="year" value="2022"
                            <%= selectedYears.includes('2022') ? 'checked' : '' %> 
                            onchange="this.form.submit()">
                            2022
                        </label><br>
    
                        <label for="year2023">
                            <input type="checkbox" id="year2023" name="year" value="2023"
                            <%= selectedYears.includes('2023') ? 'checked' : '' %>  
                            onchange="this.form.submit()">
                            2023
                        </label><br>
                    </div>
    
                    <!-- Unit price Filter -->
                    <div class="unitpriceFilter">
                        <h2>Unit Price Filter</h2>
                        <input type="text" name="minPrice" placeholder="<%= selected_minPrice %>" value="<%= selected_minPrice %>">
                        <input type="text" name="maxPrice" placeholder="<%= selected_maxPrice %>" value="<%= selected_maxPrice %>">
                        <input type="submit" class="priceFilterSubmit">
                        <button type="button" class="clearFilters">Clear</button>
                    </div>
                    
                    
                </form>
    
            </div>
            <div class="card-container">
                <% if(carsList && carsList.length > 0) { %>
                <% carsList.forEach((car) => { %>
                <div class="card <% if(car.Status === 'Active' || car.Status === 'active') { %>bg-success<% } else if(car.Status === 'Inactive' || car.Status === 'inactive') { %>bg-danger<% } else { %>bg-warning<% } %>">
                    <img src="/car_images/<%= car.Model %>.png" class="card-img-top car-image" alt="<%= car.Model %> image">
                    <div class="card-body">
                        <h5 class="card-title"><%= car.Model %></h5>
                        <p class="card-text">
                            Status: <%= car.Status %><br>
                            Year: <%= car.Year %><br>
                            Plate ID: <%= car.PlateID %><br>
                            Unit Price: <%= car.unitprice %>$<br>
                        </p>
                        <% if(car.Status === "Active" || car.Status === "active") { %>
                        <form action="/reservation" method="get">
                            <input type="hidden" name="CarID" value="<%= car.CarID %>">
                            <input type="hidden" name="CustomerID" value="<%= customerDetails.CustomerID %>">
                            <button type="submit" class="btn btn-primary">Reserve</button>
                        </form>
                        <% } %>
                        <a href="/office-details?CarID=<%= car.CarID %>" class="btn btn-secondary mt-2">Office Details</a>
                    </div>
                </div>
                <% }); %>
                <% } else { %>
                <p class="text-center">No cars available.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>

<%- include("footer") %>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const checkboxes = document.querySelectorAll('.yearFilter input[type="checkbox"]');
        const priceInputs = document.querySelectorAll('.unitpriceFilter input[type="text"]');

        // Function to clear checkboxes and price inputs
        function clearFilters() {
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });

            priceInputs.forEach(input => {
                input.value = '';
            });

            document.getElementById('filterForm').submit(); // Submit the form after clearing
        }

        // Event listener for the Clear button
        document.querySelector('.clearFilters').addEventListener('click', function() {
            clearFilters();
        });
    });
</script>
